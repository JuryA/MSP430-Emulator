<!--
  MSP430 Emulator
  Copyright (C) 2014, 2015 Rudolf Geosits (rgeosits@live.esu.edu)  
                                                                      
  This program is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.
                                                                   
  This program is distributed in the hope that it will be useful, 
  but WITHOUT ANY WARRANTY; without even the implied warranty of 
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
  GNU General Public License for more details.          
                                                       
  You should have received a copy of the GNU General Public License
  along with this program. If not, see <http://www.gnu.org/licenses
-->

<!DOCTYPE html>
<html lang="en-US">
<meta charset="utf-8"/>

<html>
    <head>

	<style>
	 body {
	     background-color: #CACACA;
	 }

	 h1 {
	     color: orange;
	     text-align: center;
	 }

	 textarea {
	     font-family: "Terminal";
	     font-size: 14px;
	     font-weight: normal;
	     resize: none;
	     overflow-y: scroll;
	 }
	</style>	

	<!-- Load the Paper.js library -->
	<script type="text/javascript" src="js/paper.js"></script>
	<script src = "http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<!-- Define inlined PaperScript associate it with myCanvas -->
	<script type="text/paperscript" canvas="myCanvas">

	 var IMG_BASE = new Point(10, 10);
	 var ws = new WebSocket('ws://127.0.0.1:9000', 'emu-protocol');
	 var msp_image = new Raster('msp', IMG_BASE.x + 145.5, 
				    IMG_BASE.y + 192);
	 
	 var console = document.getElementById('console');
	 console.value = "";

	 function print_console (text){
	     console.value = console.value + text;
	 }

	 var pause_button = document.getElementById('pause_button');
	 var play_button = document.getElementById('play_button');

	 pause_button.onclick = function(){
	     ws.send("PAUSE");
	 };

	 play_button.onclick = function(){
	     ws.send("PLAY");
	 };

	 function onMouseDown (event) {
	     ws.send(event.point.x);
	     ws.send(event.point.y);
	     
	     paper.view.update();
	 }

	 // Launchpad red LED builtin at P1.0
	 var P1_0_LED = new Path.Circle( new Point(IMG_BASE.x + 73, 
						   IMG_BASE.y + 375), 
					 6 );
	 P1_0_LED.visible = false;
	 P1_0_LED.style = {
	     fillColor: 'red',
	     strokeColor: 'red',
	     strokeWidth: 5,
	 };
	 P1_0_LED.opacity = 0.7;
	 
	 // Launchpad green LED builtin at P1.6
	 var P1_6_LED = new Path.Circle( new Point(IMG_BASE.x + 90, 
						   IMG_BASE.y + 375), 
					 6 );
	 P1_6_LED.visible = false;
	 P1_6_LED.style = {
	     fillColor: 'green',
	     strokeColor: 'green',
	     strokeWidth: 5,
	 };
	 P1_6_LED.opacity = 0.7;

	 ws.onmessage =  function (event) {
	     var msg = event.data;

	     switch (msg) {
		 case "RED_ON": {
		     P1_0_LED.visible = true;
		     break;
		 }

		 case "RED_OFF": {
		     P1_0_LED.visible = false;
		     break;
		 }

		 case "GREEN_ON": {
		     P1_6_LED.visible = true;
		     break;
		 }

		 case "GREEN_OFF": {
		     P1_6_LED.visible = false;
		     break;
		 }
		     
		 // Line of text for the console
		 default: {
		     print_console(msg);
		     break;
		 }
	     }

	     paper.view.update();
	 };

	</script>
    </head>
    
    <body>
	<textarea id="console" rows="14" cols="60" readonly="readonly"></textarea>
	<br>

	<input type="text" id="stdin" width="80">
	<button id="enter_button">enter</button> 
	<button id="pause_button" width="100" height="100">Pause</button>
	<button id="play_button" width="100" height="100">Play</button>
	<br>
	<br>
	<right>
	<canvas id="myCanvas" width="300" height="500" align="right"></canvas>
	</right>
	<img id="msp" src="msp.png" alt="msp" hidden="false"></img>
    </body>
</html>
